import discord
from discord.ext import commands
import os
import datetime
import matplotlib.pyplot as plt
from PIL import Image, ImageDraw, ImageFont

TOKEN = os.getenv("TOKEN")  # RÃ©cupÃ©ration du token depuis Railway

bot = commands.Bot(command_prefix="!")

# DÃ©finition du calendrier
jours = ["Tellion", "Sildrien", "Vaeldris", "Nythariel", "Zorvael", "LumÃ©on", "Kaelios", "Eldrith"]
mois = [
    "OrrÃ©a", "Thiloris", "VÃ¦kirn", "Dornis", "Solvannar", "Velkaris",
    "Nytheris", "Varneth", "Elthiris", "Zorvahl", "Draknar", "UmbraÃ«l",
    "AÃ«ldrin", "Kaelthor", "Eldros"
]

# CrÃ©ation de l'image du calendrier
def generer_image_calendrier():
    largeur, hauteur = 600, 400
    image = Image.new("RGB", (largeur, hauteur), "white")
    draw = ImageDraw.Draw(image)

    # Charger une police
    try:
        font = ImageFont.truetype("arial.ttf", 20)
    except:
        font = ImageFont.load_default()

    # Titre
    draw.text((180, 20), "Calendrier du Cycle des Souffles", fill="black", font=font)

    # Dessiner les jours de la semaine
    y_offset = 70
    for jour in jours:
        draw.text((20, y_offset), jour, fill="black", font=font)
        y_offset += 40

    # Sauvegarde l'image
    image_path = "/mnt/data/calendrier.png"
    image.save(image_path)
    return image_path

@bot.event
async def on_ready():
    print(f'âœ… ConnectÃ© en tant que {bot.user}')

@bot.command()
async def calendrier(ctx):
    """Affiche la date actuelle et gÃ©nÃ¨re une image du calendrier"""
    jour_lumharel = "Tellion 15 VÃ¦kirn, 1532"
    ere = "Cycle UnifiÃ©"
    festivite = "Aucune"
    phase_lunaire = "Astraelis : ðŸŒ” | VÃ¶rna : ðŸŒ˜"

    # GÃ©nÃ©ration de l'image
    image_path = generer_image_calendrier()
    
    # CrÃ©ation de l'embed
    embed = discord.Embed(
        title="ðŸ“œ Calendrier du Cycle des Souffles",
        description=f"**Nous sommes le {jour_lumharel} - Ãˆre du {ere}**\n\nâœ¨ *Que les vents de Lumharel vous soient favorables !*",
        color=0xFFD700
    )
    embed.add_field(name="ðŸŽŠ FestivitÃ©", value=festivite, inline=True)
    embed.add_field(name="ðŸŒ™ Phases Lunaires", value=phase_lunaire, inline=True)
    embed.set_footer(text="ðŸ“œ Suivez le cycle, suivez le souffle...")

    # Envoi de l'image et de l'embed
    await ctx.send(embed=embed)
    await ctx.send(file=discord.File(image_path))

@bot.command()
async def calendrierlien(ctx):
    """Renvoie le lien vers le calendrier complet."""
    await ctx.send("ðŸ”— **Consultez le calendrier complet ici :** https://app.fantasy-calendar.com/calendars/1ead959c9c963eec11424019134c7d78")

# DÃ©marrer le bot
bot.run(TOKEN)
